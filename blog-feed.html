    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
        <title>Home ¬∑ Samzy Community</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <style>
            /* === DESIGN SYSTEM === */
            :root {
                --primary: #0052CC;
                --accent: #FF6B35;
                --neutral-50: #F8FAFC;
                --neutral-200: #E2E8F0;
                --neutral-400: #94A3B8;
                --neutral-600: #64748B;
                --neutral-900: #1E293B;
                --white: #FFFFFF;
                --shadow-sm: 0 4px 12px rgba(0,0,0,0.03);
                --shadow-md: 0 6px 18px rgba(0,0,0,0.05);
                --radius-card: 16px;
                --radius-button: 40px;
                --space-1: 8px;
                --space-2: 16px;
                --space-3: 24px;
                --space-4: 32px;
                --space-5: 40px;
            }
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            }
            body {
                background: var(--neutral-50);
                color: var(--neutral-900);
                line-height: 1.5;
                padding-bottom: 70px;
            }
            a { text-decoration: none; color: inherit; }
            .container {
                max-width: 1300px;
                margin: 0 auto;
                padding: 0 var(--space-2);
            }
    
            /* Header */
            .blog-header {
                background: var(--white);
                border-bottom: 1px solid var(--neutral-200);
                position: sticky;
                top: 0;
                z-index: 100;
                padding: 0.8rem 0;
            }
            .header-container {
                max-width: 1300px;
                margin: 0 auto;
                padding: 0 var(--space-2);
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            .logo {
                font-size: 1.5rem;
                font-weight: 600;
            }
            .logo i { color: var(--primary); margin-right: 6px; }
            .logo span { color: var(--accent); }
            .header-actions {
                display: flex;
                align-items: center;
                gap: var(--space-2);
            }
            .icon-btn {
                background: none;
                border: none;
                font-size: 1.2rem;
                color: var(--neutral-600);
                cursor: pointer;
                position: relative;
                padding: 0.5rem;
                border-radius: 50%;
                transition: 0.2s;
            }
            .icon-btn:hover {
                background: var(--neutral-200);
                color: var(--primary);
            }
            .badge {
                position: absolute;
                top: 0;
                right: 0;
                background: var(--accent);
                color: white;
                font-size: 0.7rem;
                padding: 0.2rem 0.4rem;
                border-radius: 10px;
                min-width: 18px;
                text-align: center;
            }
            .user-menu {
                position: relative;
            }
            .user-avatar {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: var(--neutral-200);
                color: var(--primary);
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
                cursor: pointer;
                overflow: hidden;
            }
            .user-avatar img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            .dropdown {
                position: absolute;
                right: 0;
                top: 50px;
                background: var(--white);
                border-radius: var(--radius-card);
                box-shadow: var(--shadow-md);
                width: 200px;
                display: none;
                z-index: 200;
                border: 1px solid var(--neutral-200);
            }
            .dropdown.show { display: block; }
            .dropdown a {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 0.9rem 1.2rem;
                transition: background 0.2s;
                color: var(--neutral-900);
            }
            .dropdown a:hover { background: var(--neutral-200); }
            .dropdown i { width: 20px; color: var(--primary); }
    
            /* Notifications dropdown */
            .notifications-dropdown {
                position: absolute;
                right: 0;
                top: 50px;
                background: var(--white);
                border-radius: var(--radius-card);
                box-shadow: var(--shadow-md);
                width: 320px;
                max-height: 400px;
                overflow-y: auto;
                display: none;
                z-index: 200;
                border: 1px solid var(--neutral-200);
            }
            .notifications-dropdown.show { display: block; }
            .notification-item {
                display: flex;
                align-items: center;
                gap: var(--space-2);
                padding: var(--space-2);
                border-bottom: 1px solid var(--neutral-200);
                cursor: pointer;
                transition: background 0.2s;
            }
            .notification-item:hover { background: var(--neutral-200); }
            .notification-item.unread { background: #e6f0ff; }
            .notification-icon {
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: var(--neutral-200);
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--primary);
                font-size: 1.1rem;
            }
            .notification-content { flex: 1; }
            .notification-content p { margin: 0; font-size: 0.9rem; }
            .notification-time { font-size: 0.7rem; color: var(--neutral-400); }
            .notification-link {
                display: block;
                text-align: center;
                padding: var(--space-2);
                color: var(--primary);
                font-weight: 500;
            }
    
            /* Main layout */
            .main-container {
                max-width: 1300px;
                margin: var(--space-4) auto;
                padding: 0 var(--space-2);
                display: grid;
                grid-template-columns: 1fr 300px;
                gap: var(--space-4);
            }
            @media (max-width: 900px) {
                .main-container { grid-template-columns: 1fr; }
                .sidebar { display: none; }
            }
    
            /* Create post card */
            .create-post-card {
                background: var(--white);
                border-radius: var(--radius-card);
                border: 1px solid var(--neutral-200);
                padding: var(--space-4);
                margin-bottom: var(--space-4);
            }
            .create-post-card textarea {
                width: 100%;
                padding: var(--space-2);
                border: 1px solid var(--neutral-200);
                border-radius: var(--radius-button);
                font-size: 1rem;
                resize: vertical;
                margin-bottom: var(--space-2);
                outline: none;
            }
            .create-post-card textarea:focus {
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(0,82,204,0.1);
            }
            .post-actions {
                display: flex;
                gap: var(--space-2);
                align-items: center;
                flex-wrap: wrap;
            }
            .media-buttons {
                display: flex;
                gap: var(--space-1);
            }
            .media-btn {
                background: var(--neutral-200);
                border: none;
                padding: 0.5rem 1.2rem;
                border-radius: var(--radius-button);
                font-size: 0.9rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 6px;
                transition: 0.2s;
            }
            .media-btn i { color: var(--primary); }
            .media-btn:hover { background: var(--neutral-400); color: white; }
            .post-btn {
                background: var(--accent);
                color: white;
                border: none;
                padding: 0.6rem 2rem;
                border-radius: var(--radius-button);
                font-weight: 600;
                cursor: pointer;
                margin-left: auto;
                transition: background 0.2s;
            }
            .post-btn:disabled { background: var(--neutral-400); cursor: not-allowed; }
            .media-preview {
                margin-top: var(--space-2);
                display: flex;
                gap: var(--space-2);
                flex-wrap: wrap;
            }
            .preview-item {
                position: relative;
                width: 100px;
                height: 100px;
                border-radius: var(--radius-card);
                overflow: hidden;
                border: 1px solid var(--neutral-200);
            }
            .preview-item img, .preview-item video {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            .remove-preview {
                position: absolute;
                top: 4px;
                right: 4px;
                background: rgba(0,0,0,0.5);
                color: white;
                border: none;
                border-radius: 50%;
                width: 22px;
                height: 22px;
                cursor: pointer;
            }
            .video-warning {
                font-size: 0.8rem;
                color: var(--neutral-600);
                margin-top: 0.5rem;
            }
    
            /* Skeleton loader */
            .skeleton-card {
                background: var(--white);
                border-radius: var(--radius-card);
                border: 1px solid var(--neutral-200);
                padding: var(--space-4);
                margin-bottom: var(--space-3);
            }
            .skeleton-line {
                height: 1rem;
                background: var(--neutral-200);
                border-radius: 4px;
                margin-bottom: 0.5rem;
                animation: pulse 1.5s infinite;
            }
            .skeleton-line.title { width: 60%; height: 1.5rem; }
            .skeleton-media {
                height: 200px;
                background: var(--neutral-200);
                border-radius: var(--radius-card);
                margin: 1rem 0;
                animation: pulse 1.5s infinite;
            }
            @keyframes pulse {
                0% { opacity: 1; }
                50% { opacity: 0.5; }
                100% { opacity: 1; }
            }
    
            /* Post card */
            .post-card {
                background: var(--white);
                border-radius: var(--radius-card);
                border: 1px solid var(--neutral-200);
                padding: var(--space-4);
                margin-bottom: var(--space-3);
            }
            .post-header {
                display: flex;
                align-items: center;
                gap: var(--space-2);
                margin-bottom: var(--space-2);
            }
            .post-author-avatar {
                width: 44px;
                height: 44px;
                border-radius: 50%;
                background: var(--neutral-200);
                color: var(--primary);
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
                overflow: hidden;
            }
            .post-author-avatar img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            .post-author-info h4 { font-size: 1rem; }
            .post-author-info span { font-size: 0.8rem; color: var(--neutral-600); }
            .delete-btn {
                background: none;
                border: none;
                color: #EF4444;
                cursor: pointer;
                margin-left: auto;
                font-size: 0.9rem;
                padding: 0.2rem 0.8rem;
                border-radius: var(--radius-button);
                transition: 0.2s;
            }
            .delete-btn:hover { background: #ffebee; }
            .post-content { margin-bottom: var(--space-2); }
            .post-media {
                margin: var(--space-2) 0;
                border-radius: var(--radius-card);
                overflow: hidden;
            }
            .post-media img, .post-media video {
                width: 100%;
                max-height: 400px;
                object-fit: contain;
                background: var(--neutral-200);
            }
            .post-stats {
                display: flex;
                gap: var(--space-3);
                margin-bottom: 0.5rem;
                color: var(--neutral-600);
                font-size: 0.9rem;
            }
            .post-actions-row {
                display: flex;
                gap: var(--space-3);
                border-top: 1px solid var(--neutral-200);
                padding-top: 0.8rem;
            }
            .action-btn {
                background: none;
                border: none;
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 0.9rem;
                color: var(--neutral-600);
                cursor: pointer;
                transition: color 0.2s;
            }
            .action-btn i { font-size: 1.1rem; }
            .action-btn.liked { color: var(--accent); }
            .action-btn:hover { color: var(--primary); }
    
            /* Comments */
            .comments-section {
                margin-top: var(--space-2);
                background: var(--neutral-50);
                border-radius: var(--radius-card);
                padding: var(--space-2);
            }
            .comment {
                display: flex;
                gap: var(--space-1);
                margin-bottom: var(--space-2);
            }
            .comment-avatar {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background: var(--neutral-200);
                color: var(--primary);
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
                font-size: 0.8rem;
            }
            .comment-content {
                background: var(--white);
                padding: 0.5rem 1rem;
                border-radius: 18px;
                flex: 1;
            }
            .comment-content strong { font-size: 0.85rem; }
            .comment-content p { margin: 0.2rem 0 0; font-size: 0.9rem; }
            .comment-time { font-size: 0.7rem; color: var(--neutral-400); margin-top: 0.2rem; }
            .add-comment {
                display: flex;
                gap: var(--space-1);
                margin-top: 0.5rem;
            }
            .add-comment input {
                flex: 1;
                padding: 0.6rem 1rem;
                border: 1px solid var(--neutral-200);
                border-radius: var(--radius-button);
                font-size: 0.9rem;
                outline: none;
            }
            .add-comment input:focus { border-color: var(--primary); }
            .add-comment button {
                background: var(--primary);
                color: white;
                border: none;
                border-radius: var(--radius-button);
                padding: 0 1.5rem;
                font-weight: 500;
                cursor: pointer;
            }
    
            /* Sidebar */
            .sidebar-card {
                background: var(--white);
                border-radius: var(--radius-card);
                border: 1px solid var(--neutral-200);
                padding: var(--space-4);
                margin-bottom: var(--space-3);
            }
            .sidebar-card h3 { margin-bottom: var(--space-2); font-size: 1.1rem; }
            .stat-row { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
            .trending-tag {
                background: var(--neutral-200);
                padding: 0.4rem 1rem;
                border-radius: var(--radius-button);
                display: inline-block;
                margin: 0.2rem;
                font-size: 0.9rem;
            }
            .mentor-card {
                display: flex;
                align-items: center;
                gap: var(--space-2);
            }
            .mentor-avatar {
                width: 48px;
                height: 48px;
                border-radius: 50%;
                background: var(--primary);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
            }
            .game-teaser {
                background: var(--neutral-200);
                border-radius: var(--radius-button);
                padding: 0.8rem 1.2rem;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
    
            /* Load more button */
            .load-more-btn {
                width: 100%;
                padding: var(--space-2);
                background: var(--neutral-200);
                border: none;
                border-radius: var(--radius-button);
                font-weight: 600;
                cursor: pointer;
                margin-top: var(--space-2);
            }
            .load-more-btn:hover { background: var(--neutral-400); color: white; }
    
            /* Modal overlay for search */
            .modal-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 1000;
                align-items: center;
                justify-content: center;
            }
            .modal-overlay.active {
                display: flex;
            }
            .modal-content {
                background: var(--white);
                border-radius: var(--radius-card);
                width: 90%;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                padding: var(--space-4);
            }
            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: var(--space-3);
            }
            .modal-header h3 { font-size: 1.3rem; }
            .close-modal {
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: var(--neutral-600);
            }
            .search-input {
                width: 100%;
                padding: var(--space-2);
                border: 1px solid var(--neutral-200);
                border-radius: var(--radius-button);
                font-size: 1rem;
                margin-bottom: var(--space-3);
            }
            .search-tabs {
                display: flex;
                gap: var(--space-2);
                border-bottom: 1px solid var(--neutral-200);
                margin-bottom: var(--space-3);
            }
            .search-tab {
                background: none;
                border: none;
                padding: 0.5rem 1rem;
                cursor: pointer;
                font-weight: 500;
                color: var(--neutral-600);
                border-bottom: 2px solid transparent;
            }
            .search-tab.active {
                color: var(--primary);
                border-bottom-color: var(--primary);
            }
            .search-results {
                min-height: 200px;
            }
            .search-result-item {
                display: flex;
                align-items: center;
                gap: var(--space-2);
                padding: var(--space-2);
                border-bottom: 1px solid var(--neutral-200);
                cursor: pointer;
            }
            .search-result-item:hover { background: var(--neutral-200); }
            .result-avatar {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: var(--neutral-200);
                color: var(--primary);
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
            }
            .result-info { flex: 1; }
            .result-name { font-weight: 600; }
            .result-email { font-size: 0.8rem; color: var(--neutral-400); }
    
            /* Footer */
            .blog-footer {
                background: #000;
                color: #ccc;
                padding: 3rem 2rem 1.5rem;
                margin-top: 3rem;
            }
            .footer-container {
                max-width: 1300px;
                margin: 0 auto;
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 2rem;
            }
            .footer-col h4 { color: white; margin-bottom: 1.2rem; }
            .footer-col ul { list-style: none; }
            .footer-col li { margin-bottom: 0.6rem; }
            .footer-col a { color: #ccc; transition: color 0.2s; }
            .footer-col a:hover { color: var(--accent); }
            .social-icons {
                display: flex;
                gap: 1rem;
                font-size: 1.3rem;
            }
            .social-icons a { color: #ccc; }
            .social-icons a:hover { color: var(--accent); }
            .copyright {
                text-align: center;
                margin-top: 2rem;
                padding-top: 1.5rem;
                border-top: 1px solid #333;
                color: #777;
            }
    
            /* Bottom navigation - always visible */
            .bottom-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--white);
                border-top: 1px solid var(--neutral-200);
                padding: 0.5rem 0;
                z-index: 100;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.03);
            }
            .bottom-nav .nav-items {
                display: flex;
                justify-content: space-around;
                align-items: center;
                max-width: 600px;
                margin: 0 auto;
            }
            .bottom-nav a {
                display: flex;
                flex-direction: column;
                align-items: center;
                color: var(--neutral-600);
                font-size: 0.8rem;
                transition: color 0.2s;
            }
            .bottom-nav a i { font-size: 1.2rem; margin-bottom: 0.2rem; }
            .bottom-nav a.active { color: var(--primary); }
            .bottom-nav a:hover { color: var(--primary); }
        </style>
    </head>
    <body>
        <!-- Header -->
        <header class="blog-header">
            <div class="header-container">
                <a href="blog-feed.html" class="logo"><i class="fas fa-code"></i> SAMZY<span>blog</span></a>
                <div class="header-actions">
                    <button class="icon-btn" id="searchBtn"><i class="fas fa-search"></i></button>
                    <div class="user-menu" style="position: relative;">
                        <button class="icon-btn" id="notificationsBtn">
                            <i class="fas fa-bell"></i>
                            <span class="badge" id="notificationBadge" style="display: none;">0</span>
                        </button>
                        <div class="notifications-dropdown" id="notificationsDropdown">
                            <div id="notificationsList"></div>
                            <a href="notifications.html" class="notification-link">See all</a>
                        </div>
                    </div>
                    <div class="user-menu">
                        <div class="user-avatar" id="userAvatar"></div>
                        <div class="dropdown" id="userDropdown">
                            <a href="blog-profile.html"><i class="fas fa-user"></i> Profile</a>
                            <a href="settings.html"><i class="fas fa-cog"></i> Settings</a>
                            <a href="admin.html" id="adminLink" style="display: none;"><i class="fas fa-shield-alt"></i> Admin</a>
                            <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>
    
        <!-- Main Content -->
        <div class="main-container">
            <!-- Feed Column -->
            <div class="feed-column">
                <!-- Create Post Card -->
                <div class="create-post-card" id="createPostSection">
                    <textarea id="postContent" placeholder="What's on your mind?" rows="3"></textarea>
                    <div class="post-actions">
                        <div class="media-buttons">
                            <button class="media-btn" id="imageUploadBtn"><i class="fas fa-image"></i> Image</button>
                            <button class="media-btn" id="videoUploadBtn"><i class="fas fa-video"></i> Video</button>
                        </div>
                        <button class="post-btn" id="submitPost">Post</button>
                    </div>
                    <input type="file" id="imageInput" accept="image/*" style="display:none;">
                    <input type="file" id="videoInput" accept="video/*" style="display:none;">
                    <div class="media-preview" id="mediaPreview"></div>
                    <div class="video-warning" id="videoWarning" style="display:none;"><i class="fas fa-info-circle"></i> Videos must be 30 seconds or less.</div>
                </div>
    
                <!-- Skeleton Loaders -->
                <div id="skeletonFeed">
                    <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line meta"></div><div class="skeleton-media"></div></div>
                    <div class="skeleton-card"><div class="skeleton-line title"></div><div class="skeleton-line meta"></div><div class="skeleton-media"></div></div>
                </div>
    
                <!-- Posts Feed -->
                <div id="postsFeed" style="display: none;"></div>
                <button class="load-more-btn" id="loadMoreBtn" style="display: none;">Load More</button>
            </div>
    
            <!-- Sidebar -->
            <aside class="sidebar">
                <!-- Quick Stats card ‚Äì shown only to admins (controlled by JS) -->
                <div class="sidebar-card" id="quickStatsCard">
                    <h3>Quick Stats</h3>
                    <div class="stat-row"><span>Total members:</span> <strong id="totalMembers">0</strong></div>
                    <div class="stat-row"><span>Posts today:</span> <strong id="postsToday">0</strong></div>
                </div>
                <div class="sidebar-card">
                    <h3>Trending Topics</h3>
                    <div><span class="trending-tag">#webdev</span><span class="trending-tag">#career</span><span class="trending-tag">#mentorship</span></div>
                </div>
                <div class="sidebar-card">
                    <h3>Promoted Mentor</h3>
                    <div class="mentor-card"><div class="mentor-avatar">MK</div><div><strong>Mary K.</strong><p style="font-size:0.9rem;">Senior Developer</p></div></div>
                    <p>"Keep learning, keep growing."</p>
                </div>
                <div class="sidebar-card">
                    <h3>Play & Earn</h3>
                    <div class="game-teaser"><span>Earn points by playing games!</span><a href="blog-games.html" style="background:var(--accent); color:white; padding:0.3rem 1rem; border-radius:40px;">Go</a></div>
                </div>
            </aside>
        </div>
    
        <!-- Footer -->
        <footer class="blog-footer">
            <div class="footer-container">
                <div class="footer-col">
                    <h4>Navigation</h4>
                    <ul>
                        <li><a href="blog-feed.html">Home</a></li>
                        <li><a href="blog-profile.html">Profile</a></li>
                        <li><a href="blog-games.html">Games</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="terms.html">Terms of Service</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="cookies.html">Cookie Policy</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Connect</h4>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                        <a href="#"><i class="fab fa-github"></i></a>
                    </div>
                </div>
            </div>
            <div class="copyright">¬© 2026 Samzy Digital Community. All rights reserved.</div>
        </footer>
    
        <!-- Bottom Navigation (always visible) -->
        <div class="bottom-nav">
            <div class="nav-items">
                <a href="blog-feed.html" class="active"><i class="fas fa-home"></i><span>Home</span></a>
                <a href="reels.html"><i class="fas fa-film"></i><span>Reels</span></a>
                <a href="blog-games.html"><i class="fas fa-gamepad"></i><span>Games</span></a>
                <a href="messages.html"><i class="fas fa-comment"></i><span>Messages</span></a>
                <a href="blog-profile.html"><i class="fas fa-user"></i><span>Profile</span></a>
            </div>
        </div>
    
        <!-- Search Modal -->
        <div class="modal-overlay" id="searchModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Search</h3>
                    <button class="close-modal" id="closeSearch">&times;</button>
                </div>
                <input type="text" class="search-input" id="searchInput" placeholder="Search users or posts...">
                <div class="search-tabs">
                    <button class="search-tab active" data-type="users">Users</button>
                    <button class="search-tab" data-type="posts">Posts</button>
                </div>
                <div class="search-results" id="searchResults">
                    <!-- Results appear here -->
                </div>
            </div>
        </div>
    
        <!-- Firebase SDK -->
        <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
        <script>
            // Firebase config
            const firebaseConfig = {
                apiKey: "AIzaSyBkgwVFe1PMYMvmZxoFVFErZ27Q3XYQ-_g",
                authDomain: "samzy-community-blog.firebaseapp.com",
                projectId: "samzy-community-blog",
                storageBucket: "samzy-community-blog.firebasestorage.app",
                messagingSenderId: "573240466296",
                appId: "1:573240466296:web:5faa312a1136162961468d"
            };
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();
    
            let currentUser = null;
            let lastVisible = null;
            let loading = false;
            let hasMore = true;
    
            // Helper functions
            function stringToColor(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
                return `hsl(${hash % 360}, 70%, 80%)`;
            }
    
            function formatTimeAgo(date) {
                const s = Math.floor((new Date() - date)/1000);
                if (s < 60) return 'just now';
                if (s < 3600) return Math.floor(s/60)+'m ago';
                if (s < 86400) return Math.floor(s/3600)+'h ago';
                return Math.floor(s/86400)+'d ago';
            }
    
            // Load user avatar and check admin status
            async function loadUserAvatarAndAdmin(user) {
                const avatarDiv = document.getElementById('userAvatar');
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        const data = userDoc.data();
                        // Avatar
                        if (data.avatarURL) {
                            avatarDiv.innerHTML = `<img src="${data.avatarURL}" alt="avatar">`;
                        } else {
                            const displayName = data.displayName || user.email;
                            const initials = displayName.charAt(0).toUpperCase();
                            avatarDiv.style.background = stringToColor(displayName);
                            avatarDiv.innerHTML = `<span>${initials}</span>`;
                        }
                        // Admin check
                        const isAdmin = data.isAdmin === true;
                        const adminLink = document.getElementById('adminLink');
                        const statsCard = document.getElementById('quickStatsCard');
                        if (isAdmin) {
                            adminLink.style.display = 'flex';
                            statsCard.style.display = 'block';
                        } else {
                            adminLink.style.display = 'none';
                            statsCard.style.display = 'none';
                        }
                    } else {
                        avatarDiv.style.background = stringToColor(user.email);
                        avatarDiv.innerHTML = `<span>${user.email.charAt(0).toUpperCase()}</span>`;
                        document.getElementById('adminLink').style.display = 'none';
                        document.getElementById('quickStatsCard').style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                    avatarDiv.style.background = stringToColor(user.email);
                    avatarDiv.innerHTML = `<span>${user.email.charAt(0).toUpperCase()}</span>`;
                }
            }
    
            // Auth state
            auth.onAuthStateChanged(async user => {
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }
                currentUser = user;
                await loadUserAvatarAndAdmin(user);
                loadPosts(true);
                loadStats(); // fetch stats (card visibility handled above)
                loadNotifications();
            });
    
            // Dropdowns
            document.getElementById('userAvatar').addEventListener('click', (e) => {
                e.stopPropagation();
                document.getElementById('userDropdown').classList.toggle('show');
            });
            document.addEventListener('click', () => {
                document.getElementById('userDropdown').classList.remove('show');
                document.getElementById('notificationsDropdown').classList.remove('show');
            });
            document.getElementById('logoutBtn').addEventListener('click', (e) => {
                e.preventDefault();
                auth.signOut().then(() => window.location.href = 'community.html');
            });
    
            // Notifications
            document.getElementById('notificationsBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                document.getElementById('notificationsDropdown').classList.toggle('show');
            });
    
            async function loadNotifications() {
                if (!currentUser) return;
                try {
                    const snapshot = await db.collection('notifications')
                        .where('recipientId', '==', currentUser.uid)
                        .orderBy('createdAt', 'desc')
                        .limit(10)
                        .get();
                    const list = document.getElementById('notificationsList');
                    const badge = document.getElementById('notificationBadge');
                    let unreadCount = 0;
                    if (snapshot.empty) {
                        list.innerHTML = '<div style="padding:1rem; text-align:center;">No notifications</div>';
                        badge.style.display = 'none';
                        return;
                    }
                    let html = '';
                    snapshot.forEach(doc => {
                        const n = doc.data();
                        const date = n.createdAt ? n.createdAt.toDate() : new Date();
                        const timeAgo = formatTimeAgo(date);
                        const unreadClass = n.read ? '' : 'unread';
                        if (!n.read) unreadCount++;
                        const icon = n.type === 'like' ? '‚ù§Ô∏è' : n.type === 'comment' ? 'üí¨' : 'üë§';
                        html += `
                            <div class="notification-item ${unreadClass}" data-id="${doc.id}" data-post="${n.postId || ''}" data-from="${n.fromUserId || ''}">
                                <div class="notification-icon">${icon}</div>
                                <div class="notification-content">
                                    <p><strong>${n.fromUserName || 'Someone'}</strong> ${n.type === 'like' ? 'liked your post' : n.type === 'comment' ? 'commented on your post' : 'started following you'}</p>
                                    <div class="notification-time">${timeAgo}</div>
                                </div>
                            </div>
                        `;
                    });
                    list.innerHTML = html;
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount;
                        badge.style.display = 'inline';
                    } else {
                        badge.style.display = 'none';
                    }
                    document.querySelectorAll('.notification-item').forEach(item => {
                        item.addEventListener('click', async () => {
                            const id = item.dataset.id;
                            await db.collection('notifications').doc(id).update({ read: true });
                            if (item.dataset.post) {
                                window.location.href = `blog-feed.html?post=${item.dataset.post}`;
                            } else if (item.dataset.from) {
                                window.location.href = `blog-profile.html?uid=${item.dataset.from}`;
                            }
                        });
                    });
                } catch (e) {
                    console.error('Notifications error:', e);
                    document.getElementById('notificationsList').innerHTML = '<div style="padding:1rem; text-align:center;">Error loading notifications</div>';
                }
            }
    
            // Media upload (Cloudinary)
            let selectedImageFile = null;
            let selectedVideoFile = null;
            const imageInput = document.getElementById('imageInput');
            const videoInput = document.getElementById('videoInput');
            const mediaPreview = document.getElementById('mediaPreview');
            const videoWarning = document.getElementById('videoWarning');
    
            document.getElementById('imageUploadBtn').addEventListener('click', () => imageInput.click());
            document.getElementById('videoUploadBtn').addEventListener('click', () => videoInput.click());
    
            imageInput.addEventListener('change', e => {
                const file = e.target.files[0];
                if (file) {
                    selectedImageFile = file;
                    selectedVideoFile = null;
                    showPreview(file, 'image');
                    videoInput.value = '';
                    videoWarning.style.display = 'none';
                }
            });
    
            videoInput.addEventListener('change', e => {
                const file = e.target.files[0];
                if (file) {
                    const video = document.createElement('video');
                    video.preload = 'metadata';
                    video.onloadedmetadata = () => {
                        if (video.duration > 30) {
                            alert('Video must be 30 seconds or less.');
                            videoInput.value = '';
                            return;
                        }
                        selectedVideoFile = file;
                        selectedImageFile = null;
                        showPreview(file, 'video');
                        imageInput.value = '';
                        videoWarning.style.display = 'block';
                    };
                    video.src = URL.createObjectURL(file);
                }
            });
    
            function showPreview(file, type) {
                const reader = new FileReader();
                reader.onload = e => {
                    mediaPreview.innerHTML = `
                        <div class="preview-item">
                            ${type === 'image' ? `<img src="${e.target.result}">` : `<video src="${e.target.result}"></video>`}
                            <button class="remove-preview" onclick="clearMedia()"><i class="fas fa-times"></i></button>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            }
            window.clearMedia = function() {
                selectedImageFile = null;
                selectedVideoFile = null;
                mediaPreview.innerHTML = '';
                imageInput.value = '';
                videoInput.value = '';
                videoWarning.style.display = 'none';
            };
    
            async function uploadToCloudinary(file) {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', 'samzy-community-blog');
                const response = await fetch('https://api.cloudinary.com/v1_1/djy2jtwmw/upload', {
                    method: 'POST',
                    body: formData
                });
                if (!response.ok) throw new Error('Cloudinary upload failed');
                const data = await response.json();
                return data.secure_url;
            }
    
            // Submit post
            document.getElementById('submitPost').addEventListener('click', async () => {
                const content = document.getElementById('postContent').value.trim();
                if (!content && !selectedImageFile && !selectedVideoFile) {
                    alert('Please write something or attach media.');
                    return;
                }
                const btn = document.getElementById('submitPost');
                btn.disabled = true;
                btn.textContent = 'Uploading...';
    
                try {
                    let mediaURL = null, mediaType = null;
                    if (selectedImageFile) {
                        mediaType = 'image';
                        mediaURL = await uploadToCloudinary(selectedImageFile);
                    } else if (selectedVideoFile) {
                        mediaType = 'video';
                        mediaURL = await uploadToCloudinary(selectedVideoFile);
                    }
    
                    const userDoc = await db.collection('users').doc(currentUser.uid).get();
                    const displayName = userDoc.exists && userDoc.data().displayName ? userDoc.data().displayName : currentUser.email;
    
                    await db.collection('posts').add({
                        authorId: currentUser.uid,
                        authorName: displayName,
                        text: content,
                        mediaURL,
                        mediaType,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        likeCount: 0,
                        commentCount: 0
                    });
    
                    document.getElementById('postContent').value = '';
                    clearMedia();
                    alert('Posted!');
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error posting: ' + error.message);
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'Post';
                }
            });
    
            // Load posts
            async function loadPosts(initial = false) {
                if (loading || (!hasMore && !initial)) return;
                loading = true;
                if (initial) {
                    lastVisible = null;
                    document.getElementById('postsFeed').innerHTML = '';
                    document.getElementById('skeletonFeed').style.display = 'block';
                    document.getElementById('postsFeed').style.display = 'none';
                    document.getElementById('loadMoreBtn').style.display = 'none';
                }
    
                let query = db.collection('posts').orderBy('createdAt', 'desc').limit(10);
                if (lastVisible) {
                    query = query.startAfter(lastVisible);
                }
    
                try {
                    const snapshot = await query.get();
                    if (initial) {
                        document.getElementById('skeletonFeed').style.display = 'none';
                        document.getElementById('postsFeed').style.display = 'block';
                    }
                    if (snapshot.empty) {
                        hasMore = false;
                        document.getElementById('loadMoreBtn').style.display = 'none';
                        if (initial) {
                            document.getElementById('postsFeed').innerHTML = '<p style="text-align:center; padding:2rem;">No posts yet. Be the first to post!</p>';
                        }
                        return;
                    }
    
                    snapshot.forEach(doc => {
                        document.getElementById('postsFeed').appendChild(createPostElement(doc.data(), doc.id));
                    });
    
                    lastVisible = snapshot.docs[snapshot.docs.length - 1];
                    hasMore = snapshot.docs.length === 10;
                    document.getElementById('loadMoreBtn').style.display = hasMore ? 'block' : 'none';
                } catch (error) {
                    console.error('Error loading posts:', error);
                    document.getElementById('skeletonFeed').style.display = 'none';
                } finally {
                    loading = false;
                }
            }
    
            document.getElementById('loadMoreBtn').addEventListener('click', () => loadPosts());
    
            // Create post element
            function createPostElement(post, id) {
                const card = document.createElement('div');
                card.className = 'post-card';
                card.dataset.postId = id;
    
                const date = post.createdAt ? post.createdAt.toDate() : new Date();
                const timeAgo = formatTimeAgo(date);
                const authorName = post.authorName || 'Anonymous';
                const authorInitial = authorName.charAt(0).toUpperCase();
                const avatarColor = stringToColor(authorName);
    
                let mediaHTML = '';
                if (post.mediaURL && post.mediaType) {
                    if (post.mediaType === 'image') {
                        mediaHTML = `<div class="post-media"><img src="${post.mediaURL}" alt="post image" loading="lazy"></div>`;
                    } else if (post.mediaType === 'video') {
                        mediaHTML = `<div class="post-media"><video src="${post.mediaURL}" controls></video></div>`;
                    }
                }
    
                const deleteButton = (currentUser && post.authorId === currentUser.uid)
                    ? `<button class="delete-btn" onclick="deletePost('${id}')"><i class="fas fa-trash"></i> Delete</button>`
                    : '';
    
                const commentsHTML = `
                    <div class="comments-section" id="comments-${id}" style="display:none;">
                        <div id="comments-list-${id}"></div>
                        <div class="add-comment">
                            <input type="text" id="comment-input-${id}" placeholder="Write a comment...">
                            <button onclick="addComment('${id}')">Post</button>
                        </div>
                    </div>
                `;
    
                card.innerHTML = `
                    <div class="post-header">
                        <div class="post-author-avatar" style="background:${avatarColor};"><span>${authorInitial}</span></div>
                        <div class="post-author-info">
                            <h4>${authorName}</h4>
                            <span>${timeAgo}</span>
                        </div>
                        ${deleteButton}
                    </div>
                    <div class="post-content">${post.text || ''}</div>
                    ${mediaHTML}
                    <div class="post-stats">
                        <span><i class="fas fa-heart"></i> <span class="like-count-${id}">${post.likeCount || 0}</span></span>
                        <span><i class="fas fa-comment"></i> <span class="comment-count-${id}">${post.commentCount || 0}</span></span>
                    </div>
                    <div class="post-actions-row">
                        <button class="action-btn like-btn-${id}" onclick="toggleLike('${id}')"><i class="fas fa-heart"></i> Like</button>
                        <button class="action-btn" onclick="toggleComments('${id}')"><i class="fas fa-comment"></i> Comment</button>
                    </div>
                    ${commentsHTML}
                `;
    
                if (currentUser) {
                    db.collection('posts').doc(id).collection('likes').doc(currentUser.uid).get().then(doc => {
                        if (doc.exists) {
                            card.querySelector(`.like-btn-${id}`).classList.add('liked');
                        }
                    });
                }
    
                loadComments(id);
                return card;
            }
    
            window.deletePost = async function(postId) {
                if (!currentUser) return;
                if (!confirm('Are you sure?')) return;
                try {
                    await db.collection('posts').doc(postId).delete();
                    document.querySelector(`[data-post-id="${postId}"]`).remove();
                } catch (error) {
                    console.error(error);
                    alert('Delete failed');
                }
            };
    
            window.toggleLike = async function(postId) {
                if (!currentUser) return;
                const likeRef = db.collection('posts').doc(postId).collection('likes').doc(currentUser.uid);
                const postRef = db.collection('posts').doc(postId);
                const likeBtn = document.querySelector(`.like-btn-${postId}`);
                const likeCountSpan = document.querySelector(`.like-count-${postId}`);
                const currentCount = parseInt(likeCountSpan.textContent) || 0;
    
                const wasLiked = likeBtn.classList.contains('liked');
                if (wasLiked) {
                    likeBtn.classList.remove('liked');
                    likeCountSpan.textContent = currentCount - 1;
                } else {
                    likeBtn.classList.add('liked');
                    likeCountSpan.textContent = currentCount + 1;
                }
    
                try {
                    const likeDoc = await likeRef.get();
                    if (likeDoc.exists) {
                        await likeRef.delete();
                        await postRef.update({ likeCount: firebase.firestore.FieldValue.increment(-1) });
                    } else {
                        await likeRef.set({ userId: currentUser.uid, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                        await postRef.update({ likeCount: firebase.firestore.FieldValue.increment(1) });
                    }
                } catch (error) {
                    if (wasLiked) {
                        likeBtn.classList.add('liked');
                        likeCountSpan.textContent = currentCount;
                    } else {
                        likeBtn.classList.remove('liked');
                        likeCountSpan.textContent = currentCount;
                    }
                    console.error(error);
                }
            };
    
            window.toggleComments = function(postId) {
                const div = document.getElementById(`comments-${postId}`);
                if (div) div.style.display = div.style.display === 'none' ? 'block' : 'none';
            };
    
            window.addComment = async function(postId) {
                if (!currentUser) return;
                const input = document.getElementById(`comment-input-${postId}`);
                const text = input.value.trim();
                if (!text) return;
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const displayName = userDoc.exists && userDoc.data().displayName ? userDoc.data().displayName : currentUser.email;
                await db.collection('posts').doc(postId).collection('comments').add({
                    authorId: currentUser.uid,
                    authorName: displayName,
                    text,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                await db.collection('posts').doc(postId).update({ commentCount: firebase.firestore.FieldValue.increment(1) });
                input.value = '';
                const countSpan = document.querySelector(`.comment-count-${postId}`);
                if (countSpan) countSpan.textContent = parseInt(countSpan.textContent) + 1;
            };
    
            function loadComments(postId) {
                db.collection('posts').doc(postId).collection('comments').orderBy('createdAt', 'asc').onSnapshot(snapshot => {
                    const list = document.getElementById(`comments-list-${postId}`);
                    if (!list) return;
                    list.innerHTML = '';
                    snapshot.forEach(doc => {
                        const c = doc.data();
                        const date = c.createdAt ? c.createdAt.toDate() : new Date();
                        const timeAgo = formatTimeAgo(date);
                        const commentAuthor = c.authorName || 'Anonymous';
                        const commentInitial = commentAuthor.charAt(0).toUpperCase();
                        const avatarColor = stringToColor(commentAuthor);
                        list.innerHTML += `
                            <div class="comment">
                                <div class="comment-avatar" style="background:${avatarColor};"><span>${commentInitial}</span></div>
                                <div class="comment-content">
                                    <strong>${commentAuthor}</strong>
                                    <p>${c.text}</p>
                                    <div class="comment-time">${timeAgo}</div>
                                </div>
                            </div>
                        `;
                    });
                });
            }
    
            // Load stats (always fetch, but card visibility controlled by admin)
            async function loadStats() {
                try {
                    const usersSnap = await db.collection('users').count().get();
                    document.getElementById('totalMembers').textContent = usersSnap.data().count;
                    const today = new Date(); today.setHours(0,0,0,0);
                    const postsSnap = await db.collection('posts').where('createdAt', '>=', today).count().get();
                    document.getElementById('postsToday').textContent = postsSnap.data().count;
                } catch (e) { console.error('Stats error:', e); }
            }
    
            // Search Modal
            const searchModal = document.getElementById('searchModal');
            const searchBtn = document.getElementById('searchBtn');
            const closeSearch = document.getElementById('closeSearch');
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            let searchType = 'users';
    
            searchBtn.addEventListener('click', () => {
                searchModal.classList.add('active');
                searchInput.focus();
            });
            closeSearch.addEventListener('click', () => {
                searchModal.classList.remove('active');
            });
            document.querySelectorAll('.search-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.search-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    searchType = tab.dataset.type;
                    performSearch();
                });
            });
    
            let searchTimeout;
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(performSearch, 300);
            });
    
            async function performSearch() {
                const query = searchInput.value.trim();
                if (query.length < 2) {
                    searchResults.innerHTML = '<p style="text-align:center;">Type at least 2 characters</p>';
                    return;
                }
                searchResults.innerHTML = '<p style="text-align:center;">Searching...</p>';
                try {
                    if (searchType === 'users') {
                        const snapshot = await db.collection('users').get();
                        const users = [];
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            if ((data.displayName && data.displayName.toLowerCase().includes(query.toLowerCase())) ||
                                (data.email && data.email.toLowerCase().includes(query.toLowerCase()))) {
                                users.push({ id: doc.id, ...data });
                            }
                        });
                        displayUserResults(users.slice(0, 10));
                    } else {
                        const snapshot = await db.collection('posts').orderBy('createdAt', 'desc').get();
                        const posts = [];
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            if (data.text && data.text.toLowerCase().includes(query.toLowerCase())) {
                                posts.push({ id: doc.id, ...data });
                            }
                        });
                        displayPostResults(posts.slice(0, 10));
                    }
                } catch (e) {
                    console.error('Search error:', e);
                    searchResults.innerHTML = '<p style="text-align:center; color:red;">Error searching</p>';
                }
            }
    
            function displayUserResults(users) {
                if (users.length === 0) {
                    searchResults.innerHTML = '<p style="text-align:center;">No users found</p>';
                    return;
                }
                let html = '';
                users.forEach(user => {
                    html += `
                        <div class="search-result-item" onclick="window.location.href='blog-profile.html?uid=${user.id}'">
                            <div class="result-avatar">${user.displayName ? user.displayName[0].toUpperCase() : '?'}</div>
                            <div class="result-info">
                                <div class="result-name">${user.displayName || 'Anonymous'}</div>
                                <div class="result-email">${user.email || ''}</div>
                            </div>
                        </div>
                    `;
                });
                searchResults.innerHTML = html;
            }
    
            function displayPostResults(posts) {
                if (posts.length === 0) {
                    searchResults.innerHTML = '<p style="text-align:center;">No posts found</p>';
                    return;
                }
                let html = '';
                posts.forEach(post => {
                    html += `
                        <div class="search-result-item" onclick="window.location.href='blog-feed.html?post=${post.id}'">
                            <div class="result-avatar">${post.authorName ? post.authorName[0].toUpperCase() : '?'}</div>
                            <div class="result-info">
                                <div class="result-name">${post.authorName || 'Anonymous'}</div>
                                <div class="result-email">${post.text ? post.text.substring(0,50)+(post.text.length>50?'‚Ä¶':'') : ''}</div>
                            </div>
                        </div>
                    `;
                });
                searchResults.innerHTML = html;
            }
        </script>
    </body>
    </html>